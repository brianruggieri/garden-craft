<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pill-Shaped Bed Visual Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .test-case {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .test-case h3 {
            margin-top: 0;
            color: #2c5282;
            font-size: 18px;
        }

        .test-case p {
            color: #666;
            font-size: 14px;
            margin: 5px 0 15px 0;
        }

        canvas {
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            display: block;
            margin: 0 auto;
        }

        .stats {
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 13px;
            line-height: 1.6;
        }

        .stats-item {
            display: flex;
            justify-content: space-between;
            margin: 3px 0;
        }

        .stats-label {
            color: #666;
            font-weight: 500;
        }

        .stats-value {
            color: #2c5282;
            font-weight: 600;
        }

        .legend {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 1px solid rgba(0,0,0,0.2);
        }

        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }

        .status.pass {
            background: #d4edda;
            color: #155724;
        }

        .status.fail {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>ðŸŒ± Pill-Shaped Bed</h1> Bounds Test</h1>
    <p class="subtitle">Visual verification that plants respect rounded edges in pill/stadium-shaped beds</p>

    <div class="test-grid" id="testGrid"></div>

    <script>
        // Plant color palette
        const plantColors = {
            'Tomato': '#e74c3c',
            'Basil': '#27ae60',
            'Pepper': '#f39c12',
            'Marigold': '#e67e22',
            'Oregano': '#16a085',
            'Thyme': '#2ecc71',
            'Sage': '#95a5a6'
        };

        // Test configurations
        const testCases = [
            {
                name: 'Horizontal Pill',
                description: 'Wide bed (100" Ã— 48") - horizontal orientation',
                width: 100,
                height: 48,
                scale: 3,
                plants: generatePlants(100, 48)
            },
            {
                name: 'Vertical Pill',
                description: 'Tall bed (48" Ã— 136") - vertical orientation',
                width: 48,
                height: 136,
                scale: 2,
                plants: generatePlants(48, 136)
            },
            {
                name: 'Square-ish Pill',
                description: 'Nearly square (60" Ã— 72") - slight vertical',
                width: 60,
                height: 72,
                scale: 3,
                plants: generatePlants(60, 72)
            },
            {
                name: 'Extreme Horizontal',
                description: 'Very wide (120" Ã— 36") - extreme horizontal',
                width: 120,
                height: 36,
                scale: 2.5,
                plants: generatePlants(120, 36)
            }
        ];

        // Generate test plants for a given bed size
        function generatePlants(width, height) {
            const plants = [];
            const types = ['Tomato', 'Basil', 'Pepper', 'Marigold'];
            const radii = { 'Tomato': 12, 'Basil': 4, 'Pepper': 9, 'Marigold': 3 };

            // Simulate a simple packing (for visual test, we'll check bounds)
            const centerX = width / 2;
            const centerY = height / 2;

            for (let i = 0; i < 30; i++) {
                const angle = (i / 30) * Math.PI * 2;
                const distance = (i % 3) * 15 + 10;
                const type = types[i % types.length];
                const radius = radii[type];

                let x = centerX + Math.cos(angle) * distance;
                let y = centerY + Math.sin(angle) * distance;

                // Clamp to pill bounds
                const clamped = clampToPill(x, y, radius, width, height);

                plants.push({
                    type,
                    x: clamped.x,
                    y: clamped.y,
                    radius
                });
            }

            return plants;
        }

        // Check if circle is inside pill
        function isInsidePill(x, y, radius, width, height) {
            if (width >= height) {
                // Horizontal pill
                const capRadius = height / 2;
                const leftCapX = capRadius;
                const rightCapX = width - capRadius;
                const capY = height / 2;

                if (x >= leftCapX && x <= rightCapX) {
                    return y - radius >= 0 && y + radius <= height;
                } else if (x < leftCapX) {
                    const dx = x - leftCapX;
                    const dy = y - capY;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    return dist + radius <= capRadius;
                } else {
                    const dx = x - rightCapX;
                    const dy = y - capY;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    return dist + radius <= capRadius;
                }
            } else {
                // Vertical pill
                const capRadius = width / 2;
                const topCapY = capRadius;
                const bottomCapY = height - capRadius;
                const capX = width / 2;

                if (y >= topCapY && y <= bottomCapY) {
                    return x - radius >= 0 && x + radius <= width;
                } else if (y < topCapY) {
                    const dx = x - capX;
                    const dy = y - topCapY;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    return dist + radius <= capRadius;
                } else {
                    const dx = x - capX;
                    const dy = y - bottomCapY;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    return dist + radius <= capRadius;
                }
            }
        }

        // Clamp position to pill bounds
        function clampToPill(x, y, radius, width, height) {
            if (width >= height) {
                const capRadius = height / 2;
                const leftCapX = capRadius;
                const rightCapX = width - capRadius;
                const capY = height / 2;

                if (x >= leftCapX && x <= rightCapX) {
                    return {
                        x: Math.max(radius, Math.min(width - radius, x)),
                        y: Math.max(radius, Math.min(height - radius, y))
                    };
                } else if (x < leftCapX) {
                    const dx = x - leftCapX;
                    const dy = y - capY;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    const maxDist = capRadius - radius;
                    if (dist > maxDist) {
                        const scale = maxDist / dist;
                        return { x: leftCapX + dx * scale, y: capY + dy * scale };
                    }
                    return { x, y };
                } else {
                    const dx = x - rightCapX;
                    const dy = y - capY;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    const maxDist = capRadius - radius;
                    if (dist > maxDist) {
                        const scale = maxDist / dist;
                        return { x: rightCapX + dx * scale, y: capY + dy * scale };
                    }
                    return { x, y };
                }
            } else {
                const capRadius = width / 2;
                const topCapY = capRadius;
                const bottomCapY = height - capRadius;
                const capX = width / 2;

                if (y >= topCapY && y <= bottomCapY) {
                    return {
                        x: Math.max(radius, Math.min(width - radius, x)),
                        y: Math.max(radius, Math.min(height - radius, y))
                    };
                } else if (y < topCapY) {
                    const dx = x - capX;
                    const dy = y - topCapY;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    const maxDist = capRadius - radius;
                    if (dist > maxDist) {
                        const scale = maxDist / dist;
                        return { x: capX + dx * scale, y: topCapY + dy * scale };
                    }
                    return { x, y };
                } else {
                    const dx = x - capX;
                    const dy = y - bottomCapY;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    const maxDist = capRadius - radius;
                    if (dist > maxDist) {
                        const scale = maxDist / dist;
                        return { x: capX + dx * scale, y: bottomCapY + dy * scale };
                    }
                    return { x, y };
                }
            }
        }

        // Draw pill shape outline
        function drawPillShape(ctx, width, height, scale) {
            ctx.save();
            ctx.strokeStyle = '#8b4513';
            ctx.fillStyle = '#6b4423';
            ctx.lineWidth = 2;

            const scaledWidth = width * scale;
            const scaledHeight = height * scale;

            ctx.beginPath();

            if (width >= height) {
                // Horizontal pill
                const radius = (height / 2) * scale;
                const leftX = radius;
                const rightX = scaledWidth - radius;

                ctx.arc(leftX, radius, radius, Math.PI / 2, Math.PI * 1.5);
                ctx.lineTo(rightX, 0);
                ctx.arc(rightX, radius, radius, Math.PI * 1.5, Math.PI / 2);
                ctx.lineTo(leftX, scaledHeight);
            } else {
                // Vertical pill
                const radius = (width / 2) * scale;
                const topY = radius;
                const bottomY = scaledHeight - radius;

                ctx.arc(radius, topY, radius, Math.PI, 0);
                ctx.lineTo(scaledWidth, bottomY);
                ctx.arc(radius, bottomY, radius, 0, Math.PI);
                ctx.lineTo(0, topY);
            }

            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            ctx.restore();
        }

        // Render a test case
        function renderTest(testCase) {
            const container = document.createElement('div');
            container.className = 'test-case';

            const title = document.createElement('h3');
            title.textContent = testCase.name;
            container.appendChild(title);

            const desc = document.createElement('p');
            desc.textContent = testCase.description;
            container.appendChild(desc);

            const canvas = document.createElement('canvas');
            const canvasWidth = testCase.width * testCase.scale;
            const canvasHeight = testCase.height * testCase.scale;
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            container.appendChild(canvas);

            const ctx = canvas.getContext('2d');

            // Draw bed
            drawPillShape(ctx, testCase.width, testCase.height, testCase.scale);

            // Draw plants and check bounds
            let insideCount = 0;
            let outsideCount = 0;
            const typeCounts = {};

            testCase.plants.forEach(plant => {
                const x = plant.x * testCase.scale;
                const y = plant.y * testCase.scale;
                const r = plant.radius * testCase.scale;

                const isInside = isInsidePill(plant.x, plant.y, plant.radius, testCase.width, testCase.height);

                if (isInside) {
                    insideCount++;
                } else {
                    outsideCount++;
                }

                typeCounts[plant.type] = (typeCounts[plant.type] || 0) + 1;

                // Draw plant
                ctx.save();
                ctx.fillStyle = plantColors[plant.type] || '#999';
                ctx.globalAlpha = 0.7;
                ctx.beginPath();
                ctx.arc(x, y, r, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();

                // Draw red outline if outside bounds
                if (!isInside) {
                    ctx.save();
                    ctx.strokeStyle = '#ff0000';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(x, y, r, 0, Math.PI * 2);
                    ctx.stroke();
                    ctx.restore();
                }
            });

            // Stats
            const stats = document.createElement('div');
            stats.className = 'stats';
            stats.innerHTML = `
                <div class="stats-item">
                    <span class="stats-label">Total Plants:</span>
                    <span class="stats-value">${testCase.plants.length}</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">Inside Bounds:</span>
                    <span class="stats-value">${insideCount}</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">Outside Bounds:</span>
                    <span class="stats-value" style="color: ${outsideCount > 0 ? '#e74c3c' : '#27ae60'}">${outsideCount}</span>
                </div>
            `;
            container.appendChild(stats);

            // Status badge
            const status = document.createElement('span');
            status.className = `status ${outsideCount === 0 ? 'pass' : 'fail'}`;
            status.textContent = outsideCount === 0 ? 'âœ“ PASS' : 'âœ— FAIL';
            container.appendChild(status);

            // Legend
            const legend = document.createElement('div');
            legend.className = 'legend';
            Object.keys(typeCounts).forEach(type => {
                const item = document.createElement('div');
                item.className = 'legend-item';

                const color = document.createElement('div');
                color.className = 'legend-color';
                color.style.backgroundColor = plantColors[type];

                const label = document.createElement('span');
                label.textContent = `${type} (${typeCounts[type]})`;

                item.appendChild(color);
                item.appendChild(label);
                legend.appendChild(item);
            });
            container.appendChild(legend);

            return container;
        }

        // Render all tests
        const grid = document.getElementById('testGrid');
        testCases.forEach(testCase => {
            grid.appendChild(renderTest(testCase));
        });
    </script>
</body>
</html>
